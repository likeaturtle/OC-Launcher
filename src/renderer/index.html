<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OC-Launcher</title>
  <link rel="stylesheet" href="fontawesome/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <!-- 侧边栏 -->
    <nav class="sidebar">
      <div class="logo">
        <h1>OC-Launcher</h1>
        <span class="version" id="app-version">版本号: 加载中……</span>
      </div>
      <ul class="nav-menu">
        <li class="nav-item active" data-page="home">
          <span class="icon"><i class="fas fa-home"></i></span>
          <span>首页</span>
        </li>
        <li class="nav-item" data-page="setup">
          <span class="icon"><i class="fas fa-wrench"></i></span>
          <span>运行环境</span>
        </li>
        <li class="nav-item" data-page="config">
          <span class="icon"><i class="fas fa-file-alt"></i></span>
          <span>配置管理</span>
        </li>
        <li class="nav-item" data-page="models">
          <span class="icon"><i class="fa-brands fa-artstation"></i></span>
          <span>模型管理</span>
        </li>
        <li class="nav-item" data-page="mcp">
          <span class="icon"><i class="fas fa-plug"></i></span>
          <span>MCP 管理</span>
        </li>
        <li class="nav-item" data-page="skills">
          <span class="icon"><i class="fas fa-toolbox"></i></span>
          <span>Skills 管理</span>
        </li>
        <li class="nav-item" data-page="settings">
          <span class="icon"><i class="fas fa-cog"></i></span>
          <span>通用设置</span>
        </li>
      </ul>
    </nav>

    <!-- 主内容区 -->
    <main class="main-content">
      <!-- 首页 -->
      <div class="page active" id="page-home">
        <div class="page-header">
          <h2>欢迎使用 OC-Launcher</h2>
          <p class="subtitle">简单、快速、便捷使用 OpenCode，基于独立使用环境避免全局污染</p>
        </div>

        <div class="status-card">
          <div class="status-item">
            <span class="status-label">Node.js 环境状态</span>
            <span class="status-value" id="nodejs-status">未检测</span>
          </div>
          <div class="status-item">
            <span class="status-label">npm 源</span>
            <span class="status-value" id="npm-registry">未配置</span>
          </div>
          <div class="status-item">
            <span class="status-label">OpenCode 安装状态</span>
            <span class="status-value" id="opencode-status">未安装</span>
          </div>
        </div>

        <div class="work-dir-section">
          <h3><i class="fas fa-folder-open"></i> OpenCode 工作目录</h3>
          <div class="input-group">
            <input type="text" id="work-dir" placeholder="此处显示目录将作为 OpenCode 工作目录">
            <button class="btn btn-secondary" id="select-dir-btn">选择目录</button>
          </div>
          <p class="input-hint"><i class="fas fa-lightbulb"></i> 可点击按钮选择，同时支持手动输入路径或拖拽上传</p>
        </div>

        <div class="actions">
          <button class="btn btn-streaming btn-large" id="launch-tui-btn" disabled>
            <span class="btn-icon"><i class="fas fa-terminal"></i></span>
            <span class="btn-text">启动 TUI 界面</span>
          </button>
          <button class="btn btn-streaming btn-large" id="launch-web-btn" disabled>
            <span class="btn-icon"><i class="fas fa-globe"></i></span>
            <span class="btn-text">启动 Web 界面</span>
          </button>
        </div>

      </div>

      <!-- 环境设置页 -->
      <div class="page" id="page-setup">
        <div class="page-header">
          <h2>运行环境设置</h2>
          <p class="subtitle">配置 Node.js + npm 环境和 OpenCode 安装，支持重置运行环境</p>
        </div>

        <div class="setup-steps">
          <div class="setup-step">
            <div class="step-header">
              <span class="step-number"><i class="fa-brands fa-node-js"></i></span>
              <h3>Node.js 环境</h3>
            </div>
            <p>解压并配置独立的 Node.js 运行时（Node.js Runtime）。</p>
            <button class="btn btn-primary" id="extract-nodejs-btn">解压 Node.js</button>
            <div class="step-status" id="nodejs-extract-status"></div>
          </div>

          <div class="setup-step">
            <div class="step-header">
              <span class="step-number"><i class="fa-brands fa-npm"></i></i></span>
              <h3>npm 源配置</h3>
            </div>
            <p>首次解压 Node.js 环境默认为官方源，可能存在访问缓慢情况，建议进行修改。</p>
            <div class="input-group">
              <input type="text" id="npm-registry-input" placeholder="npm 源地址" value="https://registry.npmmirror.com">
              <div class="preset-registries">
                <button class="btn btn-link" data-registry="https://registry.npmmirror.com">阿里源</button>
                <button class="btn btn-link" data-registry="https://mirrors.cloud.tencent.com/npm/">腾讯源</button>
                <button class="btn btn-link" data-registry="https://mirrors.huaweicloud.com/repository/npm/">华为源</button>
                <button class="btn btn-link" data-registry="https://registry.npmjs.org">官方源</button>
              </div>
            </div>
            <button class="btn btn-primary" id="configure-npm-btn">设置 npm 源</button>
            <div class="step-status" id="npm-config-status"></div>
          </div>

          <div class="setup-step">
            <div class="step-header">
              <span class="step-number"><i class="fas fa-cloud-download-alt"></i></span>
              <h3>安装 / 更新 OpenCode</h3>
            </div>
            <p>使用独立 Node.js 环境安装 / 更新 OpenCode</p>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
              <button class="btn btn-primary" id="install-opencode-btn">安装 / 更新 OpenCode</button>
              <button class="btn btn-secondary" id="uninstall-opencode-btn">卸载 OpenCode</button>
              <button class="btn btn-secondary" id="install-opencode-version-btn" style="display: inline-flex; align-items: center; gap: 8px;">
                <span style="white-space: nowrap;">安装指定版本 OpenCode</span>
                <input type="text" id="opencode-version-input" placeholder="如 1.1.28" style="border: dotted; background: transparent; color: inherit; padding: 2px 4px; width: 70px;">
              </button>
            </div>
            <div class="step-status" id="opencode-install-status"></div>
            <div class="install-log" id="install-log"></div>
          </div>


          <div class="setup-divider">
            <span class="divider-text">高危行为 谨慎操作</span>
          </div>

          <div class="setup-step" style="border: 1px solid #d32f2f; background: rgba(211, 47, 47, 0.05);">
            <div class="step-header">
              <span class="step-number" style="background-color: #d32f2f;"><i class="fa-solid fa-exclamation"></i></span>
              <h3 style="color: #d32f2f;">重置环境</h3>
            </div>
            <div class="step-content-horizontal">
              <p style="color: #d32f2f; margin-bottom: 0;">此操作将清空当前用户数据目录全部内容，操作不可逆请谨慎进行！</p>
              <button class="btn btn-primary" id="reset-env-btn" style="background-color: #d32f2f; border-color: #d32f2f;">重置环境</button>
            </div>
            <div class="step-status" id="reset-env-status"></div>
          </div>
        </div>
      </div>

      <!-- 配置管理页 -->
      <div class="page" id="page-config">
        <div class="page-header">
          <h2>OpenCode 软件配置</h2>
          <p class="subtitle">可视化编辑 OpenCode 配置文件</p>
        </div>

        <div class="setup-steps">
          <div class="setup-step">
            <div class="step-header">
              <span class="step-number"><i class="fas fa-file-code"></i></span>
              <h3>生成默认配置文件</h3>
            </div>
            <p>为 OpenCode 生成默认配置文件，存储在 <code>~/.config/opencode/opencode.json</code></p>
            <div style="display: flex; gap: 10px;">
              <button class="btn btn-primary" id="generate-config-btn">生成默认配置</button>
              <button class="btn btn-secondary" id="open-config-dir-btn"><i class="fas fa-folder-open"></i> 打开配置目录</button>
            </div>
            <div class="step-status" id="generate-config-status"></div>
          </div>
        </div>
      </div>

      <!-- 模型管理页 -->
      <div class="page" id="page-models">
        <div class="page-header">
          <h2>模型管理</h2>
          <p class="subtitle">管理第三方模型服务商和模型</p>
        </div>

        <div class="setup-steps">
          <div class="setup-step">
            <div class="step-header">
              <span class="step-number"><i class="fas fa-key"></i></span>
              <h3>OpenCode Zen 模型管理</h3>
            </div>
            
            <!-- 第一部分: API Key 设置 -->
            <div class="model-section">
              <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                <h4 style="margin: 0;">API Key 设置</h4>
                <div id="zen-auth-status" style="display: none;">
                  <p style="font-size: 12px; color: #4ec9b0; margin: 0; display: flex; align-items: center; gap: 6px;">
                    <i class="fas fa-check-circle"></i>
                    <span>已配置</span>
                  </p>
                </div>
              </div>
              <div id="zen-auth-key-display" style="margin-bottom: 15px; display: none;">
                <p style="font-size: 12px; color: #858585; margin: 0; display: flex; align-items: center; gap: 6px;">
                  <span>API Key 为</span>
                  <button id="toggle-zen-key-btn" style="background: none; border: none; color: #858585; cursor: pointer; padding: 0; font-size: 13px; display: flex; align-items: center;">
                    <i class="fas fa-eye"></i>
                  </button>
                  <span id="zen-api-key-display" style="font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;">******</span>
                </p>
              </div>
              <div class="input-item">
                <label for="zen-api-key">OpenCode Zen API Key</label>
                <div style="display: flex; gap: 10px; margin-bottom: 8px; width: 100%;">
                  <input type="password" id="zen-api-key" placeholder="输入 OpenCode Zen API Key" style="flex: 1;">
                  <button class="btn btn-primary" id="save-zen-auth-btn" style="white-space: nowrap;">确认</button>
                </div>
                <p class="input-hint" style="margin: 0;">
                  访问 <a href="#" id="open-zen-link" style="color: #3794ff; text-decoration: none;">OpenCode Zen</a> 获取 API Key
                </p>
              </div>
            </div>
            
            <!-- 第二部分: 模型信息 -->
            <div class="model-section" style="margin-top: 20px; border-top: 1px solid #3c3c3c; padding-top: 20px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h4 style="margin: 0;">OpenCode Zen 模型信息</h4>
                <div style="display: flex; gap: 10px; align-items: center;">
                  <input type="text" id="zen-model-search" placeholder="搜索模型 ID" 
                    style="padding: 8px 12px; background: #3c3c3c; border: 1px solid #555555; border-radius: 4px; color: #cccccc; font-size: 13px; width: 300px;">
                </div>
              </div>
              <div id="zen-model-list-container" class="model-table-container" style="max-height: 300px;">
                <table class="model-table">
                  <thead>
                    <tr>
                      <th>默认</th>
                      <th>模型 ID</th>
                    </tr>
                  </thead>
                  <tbody id="zen-model-list-body">
                    <tr>
                      <td style="text-align: center; color: #858585;">正在加载模型信息……</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          
          <div class="setup-step">
            <div class="step-header">
              <span class="step-number"><i class="fas fa-cubes"></i></span>
              <h3>第三方模型管理</h3>
            </div>
            
            <div class="model-section">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h4 style="margin: 0;">第三方模型信息</h4>
                <div style="display: flex; gap: 10px; align-items: center;">
                  <input type="text" id="third-model-search" placeholder="搜索 PROVIDER ID / 模型名称" 
                    style="padding: 8px 12px; background: #3c3c3c; border: 1px solid #555555; border-radius: 4px; color: #cccccc; font-size: 13px; width: 300px;">
                </div>
              </div>
              <div class="model-table-container" style="max-height: 300px;">
                <table class="model-table">
                  <thead>
                    <tr>
                      <th>默认</th>
                      <th>Provider ID</th>
                      <th>模型命名</th>
                      <th>模型名称</th>
                      <th>操作</th>
                    </tr>
                  </thead>
                  <tbody id="model-list-body">
                    <tr>
                      <td colspan="5" style="text-align: center; color: #858585;">正在加载模型信息……</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="model-section" style="margin-top: 20px; border-top: 1px solid #3c3c3c; padding-top: 20px;">
              <h4>新增第三方模型</h4>
              <div class="input-grid" style="margin-bottom: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="input-item">
                  <label for="new-provider-id">Provider ID</label>
                  <input type="text" id="new-provider-id" placeholder="例如: volcengine" list="provider-datalist">
                  <datalist id="provider-datalist"></datalist>
                </div>
                <div class="input-item">
                  <label for="new-model-alias">模型命名</label>
                  <input type="text" id="new-model-alias" placeholder="例如: VolcEngine">
                </div>
                <div class="input-item">
                  <label for="new-model-name">模型名称</label>
                  <input type="text" id="new-model-name" placeholder="例如: doubao-pro">
                </div>
                <div class="input-item">
                  <label for="new-base-url">Base URL</label>
                  <input type="text" id="new-base-url" placeholder="API 请求地址">
                </div>
                <div class="input-item" style="grid-column: span 2;">
                  <label for="new-api-key">API Key</label>
                  <input type="password" id="new-api-key" placeholder="API 令牌密钥">
                </div>
              </div>
              <div class="button-group" style="display: flex; gap: 10px; justify-content: space-between; align-items: center;">
                <div style="display: flex; gap: 10px;">
                  <button class="btn btn-primary" id="add-model-btn">添加模型</button>
                  <button class="btn btn-secondary" id="clear-model-btn">清空内容</button>
                </div>
                <button class="btn btn-link" id="open-parse-modal-btn" style="font-size: 0.9em; padding: 5px 10px;"><i class="fas fa-magic"></i> 智能解析</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- MCP 服务器页 -->
      <div class="page" id="page-mcp">
        <div class="page-header">
          <h2>MCP 服务器管理及管理</h2>
          <p class="subtitle">配置和管理 Model Context Protocol 服务器</p>
        </div>
        <div class="placeholder-content">
          <div class="placeholder-icon"><i class="fas fa-plug"></i></div>
          <h3>MCP 配置</h3>
          <p>此功能将在未来版本中提供，用于可视化管理 MCP 服务器连接</p>
        </div>
      </div>

      <!-- Skills 配置页 -->
      <div class="page" id="page-skills">
        <div class="page-header">
          <h2>Skills 能力配置及管理</h2>
          <p class="subtitle">精品及定制化 Skills 管理和扩展</p>
        </div>
        <div class="placeholder-content">
          <div class="placeholder-icon"><i class="fas fa-toolbox"></i></div>
          <h3>Skills 管理</h3>
          <p>此功能将在未来版本中提供，用于可视化配置 OpenCode Skills</p>
        </div>
      </div>

      <!-- 通用设置页 -->
      <div class="page" id="page-settings">
        <div class="page-header">
          <h2>通用设置</h2>
          <p class="subtitle">管理 OC-Launcher 应用设置</p>
        </div>
        
        <div class="placeholder-content">
          <div class="placeholder-icon"><i class="fas fa-cog"></i></div>
          <h3>通用设置</h3>
          <p>此功能将在未来版本中提供更多选项，目前 Web 服务端口等配置已移至 opencode.json 控制</p>
        </div>
      </div>
    </main>
  </div>

  <div id="custom-tooltip" class="tooltip"></div>

  <!-- 修改模型弹窗 -->
  <div id="edit-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>修改模型信息</h3>
        <button class="modal-close" id="close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="input-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <input type="hidden" id="edit-old-provider-id">
          <input type="hidden" id="edit-old-model-name">
          
          <div class="input-item">
            <label>Provider ID</label>
            <input type="text" id="edit-provider-id">
          </div>
          <div class="input-item">
            <label>模型命名</label>
            <input type="text" id="edit-model-alias">
          </div>
          <div class="input-item">
            <label>模型名称</label>
            <input type="text" id="edit-model-name">
          </div>
          <div class="input-item">
            <label>Base URL</label>
            <input type="text" id="edit-base-url">
          </div>
          <div class="input-item" style="grid-column: span 2;">
            <label>API Key</label>
            <input type="password" id="edit-api-key">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancel-edit">取消</button>
        <button class="btn btn-primary" id="save-edit">保存修改</button>
      </div>
    </div>
  </div>

  <!-- 智能解析弹窗 -->
  <div id="parse-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>智能解析示例代码</h3>
        <button class="modal-close" id="close-parse-modal">&times;</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom: 10px; color: #cccccc; font-size: 0.9em;">将包含 base_url 和 model 的示例代码（如 Python/OpenAI SDK 代码）粘贴到下方：</p>
        <textarea id="parse-code-input" style="width: 100%; height: 200px; background: #1e1e1e; border: 1px solid #3c3c3c; color: #ffffff; padding: 10px; border-radius: 4px; resize: vertical; font-family: 'Consolas', 'Monaco', monospace;" placeholder="例如:
client = OpenAI(
    api_key='your_key',
    base_url='https://api.example.com/v1'
)
completion = client.chat.completions.create(
    model='gpt-3.5-turbo',
    ...
)"></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancel-parse">取消</button>
        <button class="btn btn-primary" id="confirm-parse">确认解析</button>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
</body>
</html>
